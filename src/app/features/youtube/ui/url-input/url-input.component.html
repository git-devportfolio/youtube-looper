<form [formGroup]="urlForm" (ngSubmit)="onSubmit()" class="url-input-form">
  <div class="url-input-container">
    <!-- Label -->
    <label for="url-input" class="url-input-label">
      <span class="label-text">URL de la vidéo YouTube</span>
      <span class="label-required">*</span>
    </label>

    <!-- Champ de saisie avec icônes -->
    <div class="url-input-wrapper" [class.has-error]="isUrlInvalid" [class.has-success]="showValidIcon">
      <!-- Icône YouTube à gauche -->
      <div class="url-input-icon url-input-icon--left">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="2" y="6" width="20" height="12" rx="2" stroke="currentColor" stroke-width="1.5"/>
          <path d="M8 12l6-3v6l-6-3z" fill="currentColor"/>
        </svg>
      </div>

      <!-- Input -->
      <input
        #urlInput
        id="url-input"
        type="url"
        formControlName="url"
        [placeholder]="currentPlaceholder"
        (paste)="onPaste($event)"
        class="url-input-field"
        autocomplete="url"
        spellcheck="false">

      <!-- Icônes de statut à droite -->
      <div class="url-input-icon url-input-icon--right">
        @if (showLoadingSpinner) {
          <div class="loading-spinner" aria-label="Validation en cours...">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="spinner">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" opacity="0.25"/>
              <path d="M12 2a10 10 0 0 1 10 10" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
        } @else if (showValidIcon) {
          <div class="success-icon" aria-label="URL valide">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 12l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
        }
      </div>

      <!-- Bouton Clear -->
      @if (urlControl?.value?.trim()) {
        <button
          type="button"
          (click)="onClear()"
          class="url-input-clear"
          aria-label="Effacer l'URL"
          title="Effacer">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2"/>
            <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2"/>
          </svg>
        </button>
      }
    </div>

    <!-- Messages d'erreur -->
    @if (isUrlInvalid && validationErrorMessage) {
      <div class="url-input-error" role="alert">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="error-icon-small">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5"/>
          <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="1.5"/>
          <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="1.5"/>
        </svg>
        {{ validationErrorMessage }}
      </div>
    }

    @if (hasError() && errorMessage()) {
      <div class="url-input-error" role="alert">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="error-icon-small">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5"/>
          <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="1.5"/>
          <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="1.5"/>
        </svg>
        {{ errorMessage() }}
      </div>
    }

    <!-- Informations sur l'URL valide -->
    @if (urlInfo() && !hasError() && !isUrlInvalid) {
      <div class="url-input-info">
        <div class="url-info-item">
          <span class="url-info-label">ID de la vidéo :</span>
          <code class="url-info-value">{{ urlInfo()!.videoId }}</code>
        </div>
        @if (urlInfo()!.startTime) {
          <div class="url-info-item">
            <span class="url-info-label">Temps de démarrage :</span>
            <span class="url-info-value">{{ urlInfo()!.startTime }}s</span>
          </div>
        }
      </div>
    }

    <!-- Boutons d'action -->
    <div class="url-input-actions">
      <button
        type="submit"
        [disabled]="!isUrlValid || isLoading()"
        class="url-input-button url-input-button--primary">
        @if (isLoading()) {
          <span class="button-spinner"></span>
          Validation...
        } @else {
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="button-icon">
            <path d="M8 12l6-3v6l-6-3z" fill="currentColor"/>
            <rect x="2" y="6" width="20" height="12" rx="2" stroke="currentColor" stroke-width="1.5"/>
          </svg>
          Charger la vidéo
        }
      </button>

      @if (urlControl?.value?.trim()) {
        <button
          type="button"
          (click)="onClear()"
          class="url-input-button url-input-button--secondary">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="button-icon">
            <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="1.5"/>
            <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="1.5"/>
          </svg>
          Effacer
        </button>
      }
    </div>

    <!-- Aide contextuelle -->
    <div class="url-input-help">
      <p class="help-text">
        <strong>Formats supportés :</strong>
      </p>
      <ul class="help-list">
        <li><code>https://www.youtube.com/watch?v=VIDEO_ID</code></li>
        <li><code>https://youtu.be/VIDEO_ID</code></li>
        <li><code>https://youtube.com/watch?v=VIDEO_ID&amp;t=30s</code> (avec temps)</li>
      </ul>
    </div>
  </div>
</form>