<div class="audio-player">
  <!-- Bouton Play/Pause -->
  <button
    class="audio-player__play-button"
    [class.audio-player__play-button--playing]="isPlaying()"
    [disabled]="!isReady()"
    (click)="togglePlayPause()"
    type="button"
    [attr.aria-label]="isPlaying() ? 'Pause' : 'Play'"
  >
    <!-- Icône Play -->
    @if (!isPlaying()) {
      <svg class="audio-player__icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M5 3l14 9-14 9V3z" fill="currentColor"/>
      </svg>
    }

    <!-- Icône Pause -->
    @if (isPlaying()) {
      <svg class="audio-player__icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="6" y="4" width="4" height="16" fill="currentColor"/>
        <rect x="14" y="4" width="4" height="16" fill="currentColor"/>
      </svg>
    }
  </button>

  <!-- Affichage des temps -->
  <div class="audio-player__time-display">
    <span class="audio-player__current-time">{{ formattedCurrentTime() }}</span>
    <span class="audio-player__separator">/</span>
    <span class="audio-player__duration">{{ formattedDuration() }}</span>
  </div>

  <!-- Badges Pitch et Speed (discrets) -->
  @if (hasActivePitch() || hasActiveSpeed()) {
    <div class="audio-player__badges">
      @if (hasActivePitch()) {
        <span class="audio-player__badge audio-player__badge--pitch">
          Pitch {{ pitchLabel() }}
        </span>
      }
      @if (hasActiveSpeed()) {
        <span class="audio-player__badge audio-player__badge--speed">
          {{ speedLabel() }}
        </span>
      }
    </div>
  }

  <!-- Bouton Partager ou Télécharger (minimaliste) -->
  <button
    class="audio-player__share-btn"
    [class.audio-player__share-btn--loading]="isSharing()"
    [disabled]="(!isShareAvailable() && !useDownloadFallback()) || isSharing()"
    (click)="shareAudio()"
    type="button"
    [attr.aria-label]="isSharing() ? 'Encodage en cours: ' + sharingProgress() + '%' : (useDownloadFallback() ? 'Télécharger l\'audio' : 'Partager l\'audio')"
  >
    @if (isSharing()) {
      <!-- Indicateur de progression circulaire -->
      <svg class="audio-player__share-icon audio-player__share-icon--spinner" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-opacity="0.25" fill="none"/>
        <path d="M12 2 A10 10 0 0 1 22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/>
      </svg>
    } @else if (useDownloadFallback()) {
      <!-- Icône de téléchargement (flèche vers le bas dans un plateau) -->
      <svg class="audio-player__share-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 3V16M12 16L7 11M12 16L17 11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M3 17V19C3 20.1046 3.89543 21 5 21H19C20.1046 21 21 20.1046 21 19V17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    } @else {
      <!-- Icône de partage (flèche sortant d'une boîte) -->
      <svg class="audio-player__share-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M8.59 16.59L13.17 12L8.59 7.41L10 6L16 12L10 18L8.59 16.59Z" fill="currentColor"/>
        <path d="M3 3H14V5H5V19H19V10H21V21H3V3Z" stroke="currentColor" stroke-width="1.5" fill="none"/>
        <path d="M21 3L21 9M21 3L15 3M21 3L13 11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    }
  </button>

  <!-- Bouton Réglages Audio (minimaliste) -->
  <button
    class="audio-player__settings-btn"
    [class.audio-player__settings-btn--modified]="hasActiveModifications()"
    [disabled]="!isReady()"
    (click)="openAudioControls()"
    type="button"
    [attr.aria-label]="hasActiveModifications() ? 'Réglages audio modifiés: ' + modificationsLabel() : 'Réglages audio'"
  >
    <!-- Icône sliders minimaliste -->
    <svg class="audio-player__settings-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <line x1="4" y1="21" x2="4" y2="14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="4" y1="10" x2="4" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="12" y1="21" x2="12" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="12" y1="8" x2="12" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="20" y1="21" x2="20" y2="16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="20" y1="12" x2="20" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <circle cx="4" cy="12" r="2" fill="currentColor"/>
      <circle cx="12" cy="10" r="2" fill="currentColor"/>
      <circle cx="20" cy="14" r="2" fill="currentColor"/>
    </svg>
  </button>

  <!-- Modal des contrôles audio (caché par défaut) -->
  <app-audio-controls-modal></app-audio-controls-modal>
</div>
