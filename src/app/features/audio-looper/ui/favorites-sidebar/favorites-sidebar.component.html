<!-- Overlay semi-transparent -->
@if (isOpen()) {
  <div class="sidebar-overlay" (click)="onOverlayClick()"></div>
}

<!-- Sidebar coulissant -->
<aside class="favorites-sidebar" [class.open]="isOpen()">
  <!-- Header -->
  <header class="sidebar-header">
    <!-- Titre et bouton fermer -->
    <div class="header-top">
      <h2 class="sidebar-title">Mes Favoris</h2>
      <button
        type="button"
        class="btn-close-header"
        (click)="onClose()"
        aria-label="Fermer">
        ×
      </button>
    </div>

    <!-- Compteur de favoris et taille -->
    <div class="sidebar-stats">
      <span class="stats-text">
        {{ favoritesCount() }}/{{ maxFavorites() }} favoris •
        {{ sizeMB() }} MB / {{ maxSizeMB() }} MB
      </span>
      <div class="stats-bar">
        <div class="stats-bar-fill" [style.width.%]="usagePercentage()"></div>
      </div>
    </div>
  </header>

  <!-- Contenu principal (liste des favoris) -->
  <div class="sidebar-content">
    @if (favoritesCount() === 0) {
      <div class="empty-state">
        <p class="empty-state-text">Aucun favori enregistré</p>
        <p class="empty-state-hint">Uploadez un fichier audio pour commencer</p>
      </div>
    } @else {
      <div class="favorites-list"
           cdkDropList
           [cdkDropListDisabled]="!isEditMode()"
           (cdkDropListDropped)="onDrop($event)">
        @for (favorite of favorites(); track favorite.id) {
          <app-favorite-card
            cdkDrag
            [cdkDragDisabled]="!isEditMode()"
            [favorite]="favorite"
            [isEditMode]="isEditMode()"
            (load)="onLoadFavorite($event)"
            (play)="onPlayFavorite($event)"
            (delete)="onDeleteFavorite($event)">

            <!-- Placeholder pendant le drag -->
            <div class="drag-placeholder" *cdkDragPlaceholder></div>
          </app-favorite-card>
        }
      </div>
    }
  </div>

  <!-- Footer -->
  <footer class="sidebar-footer">
    <!-- Mode normal : Bouton édition + Upload -->
    @if (!isEditMode()) {
      <div class="sidebar-actions">
        <!-- Bouton icône "Modifier l'ordre" -->
        <button
          type="button"
          class="btn-icon btn-edit-order"
          (click)="onToggleEditMode()"
          [disabled]="favoritesCount() === 0"
          aria-label="Modifier l'ordre">
          ≡
        </button>

        <!-- Bouton textuel "Upload nouveau fichier" -->
        <button
          type="button"
          class="btn-action btn-upload"
          (click)="onUploadNewFile()"
          [disabled]="favoritesCount() >= maxFavorites()">
          Upload nouveau fichier
        </button>
      </div>
    }

    <!-- Mode édition : Message + Bouton valider -->
    @if (isEditMode()) {
      <div class="edit-mode-bar">
        <div class="edit-mode-message">
          <span class="edit-mode-icon">≡</span>
          <span class="edit-mode-text">Glissez pour réorganiser</span>
        </div>
        <button
          type="button"
          class="btn-validate"
          (click)="onToggleEditMode()"
          aria-label="Terminer l'édition">
          ✓ Terminer
        </button>
      </div>
    }
  </footer>
</aside>
