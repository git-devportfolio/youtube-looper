<!-- Overlay semi-transparent -->
@if (isOpen()) {
  <div class="sidebar-overlay" (click)="onOverlayClick()"></div>
}

<!-- Sidebar coulissant -->
<aside class="favorites-sidebar" [class.open]="isOpen()">
  <!-- Header -->
  <header class="sidebar-header">
    <h2 class="sidebar-title">Mes Favoris</h2>

    <!-- Compteur de favoris et taille -->
    <div class="sidebar-stats">
      <span class="stats-text">
        {{ favoritesCount() }}/{{ maxFavorites() }} favoris •
        {{ sizeMB() }} MB / {{ maxSizeMB() }} MB
      </span>
      <div class="stats-bar">
        <div class="stats-bar-fill" [style.width.%]="usagePercentage()"></div>
      </div>
    </div>

    <!-- Boutons d'action -->
    <div class="sidebar-actions">
      <button
        type="button"
        class="btn-action btn-edit-order"
        [class.btn-edit-order--active]="isEditMode()"
        (click)="onToggleEditMode()"
        [disabled]="favoritesCount() === 0">
        {{ isEditMode() ? 'Terminer' : 'Modifier l\'ordre' }}
      </button>
      @if (!isEditMode()) {
        <button
          type="button"
          class="btn-action btn-upload"
          (click)="onUploadNewFile()"
          [disabled]="favoritesCount() >= maxFavorites()">
          Upload nouveau fichier
        </button>
      }
    </div>

    <!-- Message d'aide en mode édition -->
    @if (isEditMode()) {
      <div class="edit-mode-help">
        <p class="edit-mode-help-text">
          Glissez-déposez les cartes pour réorganiser vos favoris
        </p>
      </div>
    }
  </header>

  <!-- Contenu principal (liste des favoris) -->
  <div class="sidebar-content">
    @if (favoritesCount() === 0) {
      <div class="empty-state">
        <p class="empty-state-text">Aucun favori enregistré</p>
        <p class="empty-state-hint">Uploadez un fichier audio pour commencer</p>
      </div>
    } @else {
      <div class="favorites-list"
           cdkDropList
           [cdkDropListDisabled]="!isEditMode()"
           (cdkDropListDropped)="onDrop($event)">
        @for (favorite of favorites(); track favorite.id) {
          <app-favorite-card
            cdkDrag
            [cdkDragDisabled]="!isEditMode()"
            [favorite]="favorite"
            [isEditMode]="isEditMode()"
            (load)="onLoadFavorite($event)"
            (play)="onPlayFavorite($event)"
            (delete)="onDeleteFavorite($event)">

            <!-- Placeholder pendant le drag -->
            <div class="drag-placeholder" *cdkDragPlaceholder></div>
          </app-favorite-card>
        }
      </div>
    }
  </div>

  <!-- Footer -->
  <footer class="sidebar-footer">
    <button
      type="button"
      class="btn-close"
      (click)="onClose()">
      Fermer
    </button>
  </footer>
</aside>
